<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ê²Œì‹œíŒ ìƒ˜í”Œ</title>
    <link rel="stylesheet" href="./bulletin_borard.css" />
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ğŸ“ ë©‹ì§„ ê²Œì‹œíŒ</h1>
        <p>ë‹¹ì‹ ì˜ ìƒê°ì„ ììœ ë¡­ê²Œ ê³µìœ í•˜ì„¸ìš”!</p>
        <div class="stats">
          <div class="stat-item">
            <span class="stat-number" id="postCount">0</span>
            <span>ê²Œì‹œê¸€</span>
          </div>
          <div class="stat-item">
            <span class="stat-number" id="todayCount">0</span>
            <span>ì˜¤ëŠ˜ ì‘ì„±</span>
          </div>
        </div>
      </div>

      <div class="write-section">
        <h2>âœï¸ ìƒˆ ê¸€ ì‘ì„±</h2>
        <form id="postForm">
          <div class="form-group">
            <label for="author">ì‘ì„±ì</label>
            <input
              type="text"
              id="author"
              class="form-control"
              placeholder="ì‘ì„±ìëª…ì„ ì…ë ¥í•˜ì„¸ìš”"
              required
            />
          </div>
          <div class="form-group">
            <label for="title">ì œëª©</label>
            <input
              type="text"
              id="title"
              class="form-control"
              placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
              required
            />
          </div>
          <div class="form-group">
            <label for="content">ë‚´ìš©</label>
            <textarea
              id="content"
              class="form-control"
              placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"
              required
            ></textarea>
          </div>
          <button type="submit" class="btn">ğŸ“ ë“±ë¡í•˜ê¸°</button>
          <button type="button" class="btn" onclick="resetForm()">
            ğŸ”„ ì´ˆê¸°í™”
          </button>
        </form>
      </div>

      <div class="post-list">
        <h2>ğŸ“‹ ê²Œì‹œê¸€ ëª©ë¡</h2>
        <div id="postContainer">
          <div class="empty-state">
            <div style="font-size: 4rem">ğŸ“­</div>
            <h3>ì•„ì§ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤</h3>
            <p>ì²« ë²ˆì§¸ ê²Œì‹œê¸€ì„ ì‘ì„±í•´ë³´ì„¸ìš”!</p>
          </div>
        </div>
      </div>
    </div>

    <!-- ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="editModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2>ğŸ“ ê²Œì‹œê¸€ ìˆ˜ì •</h2>
        <form id="editForm">
          <div class="form-group">
            <label for="editAuthor">ì‘ì„±ì</label>
            <input type="text" id="editAuthor" class="form-control" required />
          </div>
          <div class="form-group">
            <label for="editTitle">ì œëª©</label>
            <input type="text" id="editTitle" class="form-control" required />
          </div>
          <div class="form-group">
            <label for="editContent">ë‚´ìš©</label>
            <textarea id="editContent" class="form-control" required></textarea>
          </div>
          <button type="submit" class="btn">ğŸ’¾ ìˆ˜ì • ì™„ë£Œ</button>
          <button type="button" class="btn" onclick="closeModal()">
            âŒ ì·¨ì†Œ
          </button>
        </form>
      </div>
    </div>

    <script>
      // ê²Œì‹œê¸€ ë°ì´í„° ì €ì¥ì†Œ (ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ìš©)
      let posts = [];
      let currentEditId = null;

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
      document.addEventListener("DOMContentLoaded", function () {
        // ìƒ˜í”Œ ë°ì´í„° ì¶”ê°€
        posts = [
          {
            id: 1,
            author: "ê´€ë¦¬ì",
            title: "ê²Œì‹œíŒ ì˜¤í”ˆì„ ì¶•í•˜í•©ë‹ˆë‹¤! ğŸ‰",
            content:
              "ì•ˆë…•í•˜ì„¸ìš”! ìƒˆë¡œìš´ ê²Œì‹œíŒì´ ì˜¤í”ˆë˜ì—ˆìŠµë‹ˆë‹¤.\nììœ ë¡­ê²Œ ê¸€ì„ ì‘ì„±í•˜ê³  ì†Œí†µí•´ë³´ì„¸ìš”.",
            createdAt: new Date().toISOString(),
          },
        ];

        renderPosts();
        updateStats();
      });

      // ê²Œì‹œê¸€ ë“±ë¡
      document
        .getElementById("postForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const author = document.getElementById("author").value.trim();
          const title = document.getElementById("title").value.trim();
          const content = document.getElementById("content").value.trim();

          if (!author || !title || !content) {
            alert("ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”! ğŸ˜Š");
            return;
          }

          const newPost = {
            id: Date.now(),
            author: author,
            title: title,
            content: content,
            createdAt: new Date().toISOString(),
          };

          posts.unshift(newPost); // ìƒˆ ê¸€ì„ ë§¨ ì•ì— ì¶”ê°€
          renderPosts();
          updateStats();
          resetForm();

          // ì„±ê³µ ì• ë‹ˆë©”ì´ì…˜
          showNotification("ê²Œì‹œê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸŠ");
        });

      // ê²Œì‹œê¸€ ëª©ë¡ ë Œë”ë§
      function renderPosts() {
        const container = document.getElementById("postContainer");

        if (posts.length === 0) {
          container.innerHTML = `
                    <div class="empty-state">
                        <div style="font-size: 4rem;">ğŸ“­</div>
                        <h3>ì•„ì§ ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p>ì²« ë²ˆì§¸ ê²Œì‹œê¸€ì„ ì‘ì„±í•´ë³´ì„¸ìš”!</p>
                    </div>
                `;
          return;
        }

        container.innerHTML = posts
          .map(
            (post) => `
                <div class="post-item">
                    <div class="post-header">
                        <div>
                            <div class="post-title">${escapeHtml(
                              post.title
                            )}</div>
                            <div class="post-meta">
                                ğŸ‘¤ ${escapeHtml(post.author)} | 
                                ğŸ“… ${formatDate(post.createdAt)}
                            </div>
                        </div>
                    </div>
                    <div class="post-content">${escapeHtml(post.content)}</div>
                    <div class="post-actions">
                        <button class="btn btn-edit" onclick="editPost(${
                          post.id
                        })">âœï¸ ìˆ˜ì •</button>
                        <button class="btn btn-delete" onclick="deletePost(${
                          post.id
                        })">ğŸ—‘ï¸ ì‚­ì œ</button>
                    </div>
                </div>
            `
          )
          .join("");
      }

      // ê²Œì‹œê¸€ ìˆ˜ì •
      function editPost(id) {
        const post = posts.find((p) => p.id === id);
        if (!post) return;

        currentEditId = id;
        document.getElementById("editAuthor").value = post.author;
        document.getElementById("editTitle").value = post.title;
        document.getElementById("editContent").value = post.content;
        document.getElementById("editModal").style.display = "block";
      }

      // ìˆ˜ì • í¼ ì œì¶œ
      document
        .getElementById("editForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const author = document.getElementById("editAuthor").value.trim();
          const title = document.getElementById("editTitle").value.trim();
          const content = document.getElementById("editContent").value.trim();

          if (!author || !title || !content) {
            alert("ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”! ğŸ˜Š");
            return;
          }

          const postIndex = posts.findIndex((p) => p.id === currentEditId);
          if (postIndex !== -1) {
            posts[postIndex] = {
              ...posts[postIndex],
              author: author,
              title: title,
              content: content,
            };

            renderPosts();
            closeModal();
            showNotification("ê²Œì‹œê¸€ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤! âœ¨");
          }
        });

      // ê²Œì‹œê¸€ ì‚­ì œ
      function deletePost(id) {
        if (confirm("ì •ë§ë¡œ ì´ ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ğŸ¤”")) {
          posts = posts.filter((p) => p.id !== id);
          renderPosts();
          updateStats();
          showNotification("ê²Œì‹œê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ—‘ï¸");
        }
      }

      // ëª¨ë‹¬ ë‹«ê¸°
      function closeModal() {
        document.getElementById("editModal").style.display = "none";
        currentEditId = null;
      }

      // í¼ ì´ˆê¸°í™”
      function resetForm() {
        document.getElementById("postForm").reset();
      }

      // í†µê³„ ì—…ë°ì´íŠ¸
      function updateStats() {
        document.getElementById("postCount").textContent = posts.length;

        const today = new Date().toDateString();
        const todayPosts = posts.filter(
          (post) => new Date(post.createdAt).toDateString() === today
        ).length;
        document.getElementById("todayCount").textContent = todayPosts;
      }

      // ë‚ ì§œ í¬ë§·íŒ…
      function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleString("ko-KR", {
          year: "numeric",
          month: "2-digit",
          day: "2-digit",
          hour: "2-digit",
          minute: "2-digit",
        });
      }

      // HTML ì´ìŠ¤ì¼€ì´í”„ (XSS ë°©ì§€)
      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      // ì•Œë¦¼ í‘œì‹œ
      function showNotification(message) {
        const notification = document.createElement("div");
        notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(45deg, #4CAF50, #45a049);
                color: white;
                padding: 15px 25px;
                border-radius: 25px;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                z-index: 2000;
                animation: slideIn 0.3s ease;
            `;
        notification.textContent = message;

        document.body.appendChild(notification);

        setTimeout(() => {
          notification.style.animation = "slideOut 0.3s ease";
          setTimeout(() => {
            document.body.removeChild(notification);
          }, 300);
        }, 3000);
      }

      // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
      window.onclick = function (event) {
        const modal = document.getElementById("editModal");
        if (event.target === modal) {
          closeModal();
        }
      };

      // ì• ë‹ˆë©”ì´ì…˜ CSS ì¶”ê°€
      const style = document.createElement("style");
      style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
      document.head.appendChild(style);
    </script>
  </body>
</html>
